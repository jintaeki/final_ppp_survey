<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.mycompany.webapp.dao.ILoginCheckRepository">

	<select id="checkUser"
		parameterType="com.mycompany.webapp.dto.UserCheckDTO" resultType="int">
		SELECT COUNT(*) 
		FROM user_info
        WHERE  EMAIL =  #{email} AND EMPLOYEE_ID = #{raterId}
		
	</select>
	
		<select id="getUserManagerYN"
		parameterType="com.mycompany.webapp.dto.UserCheckDTO" resultType="string">
		SELECT MANAGER_YN 
		FROM user_info
        WHERE  EMAIL =  #{email} AND EMPLOYEE_ID = #{raterId}
		
	</select>
	
	<select id="getUserInfo"
		parameterType="com.mycompany.webapp.dto.UserCheckDTO" resultType="hashmap">
		SELECT S.SURVEY_SEQ, 
               S.SURVEY_NAME, 
               M.RATER_ID, 
               UR.EMPLOYEE_NAME AS RATER_NAME, 
               GR.GRADE_NAME AS RATER_GRADE_NAME,
               OCR.DEPARTMENT_NAME AS RATER_DEPRTMENT_NAME,
               M.APPRAISEE_ID, 
               UA.EMPLOYEE_NAME AS APPRAISEE_NAME,
               GA.GRADE_NAME AS APPRAISEE_GRADE_NAME,
               OCA.DEPARTMENT_NAME AS APPRAISEE_DEPRTMENT_NAME,
               M.SURVEY_COMPLETE_YN,
               UR.EMAIL,
               UR.MANAGER_YN
        FROM USER_INFO UR , USER_INFO UA, SURVEY_LIST S, MAPPING M,GRADE GR, GRADE GA,
       ORGANIZATION_CHART OCR, ORGANIZATION_CHART OCA 
        WHERE 
              S.SURVEY_CLOSED_DATE >= SYSDATE-1 AND
              UR.EMPLOYEE_ID = M.RATER_ID AND
              UR.GRADE_ID = GR.GRADE_ID AND
              UR.DEPARTMENT_ID = OCR.DEPARTMENT_ID AND
              UA.EMPLOYEE_ID = M.APPRAISEE_ID AND
              UA.GRADE_ID = GA.GRADE_ID AND
              UA.DEPARTMENT_ID = OCA.DEPARTMENT_ID AND
              S.SURVEY_SEQ = M.SURVEY_SEQ AND
              UR.EMAIL = #{email} AND
              UR.EMPLOYEE_ID = #{raterId}

	</select>

	<select id="getQuestion" parameterType="int" resultType="hashmap">
      SELECT SURVEY_QUESTION.SURVEY_SEQ
       		,SURVEY_QUESTION.QUESTION_SEQ
            ,SURVEY_QUESTION.QUESTION_CONTENT
            ,SURVEY_QUESTION.QUESTION_TYPE_CODE
            ,SURVEY_ITEM.ITEM_SEQ
            ,SURVEY_ITEM.ITEM_CONTENT
           r ,SURVEY_ITEM.ITEM_SCORE
      FROM  SURVEY_ITEM  right join SURVEY_QUESTION
      on SURVEY_ITEM.QUESTION_SEQ = SURVEY_QUESTION.QUESTION_SEQ
      where SURVEY_QUESTION.SURVEY_SEQ = #{surveySeq} ORDER BY SURVEY_QUESTION.QUESTION_SEQ DESC
   </select>
	
	
</mapper>