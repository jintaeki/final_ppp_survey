<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycompany.webapp.dao.ISurveyRepository">

	<insert id="setQuestInsert" parameterType="SQD">
		<![CDATA[
				INSERT INTO SURVEY_QUESTION(QUESTION_SEQ, SURVEY_SEQ, QUESTION_CONTENT, QUESTION_TYPE_CODE,ADD_DATE,UPDATE_DATE)
				values (#{questionSeq}, #{surveySeq}, #{questionContent}, #{questionTypeCode}, sysdate, sysdate)
		]]>
	</insert>
	
	<select id="selectMaxQuestionId" resultType="int">
	
	<![CDATA[
				SELECT NVL(MAX(QUESTION_SEQ), 0) AS "questionSeq" FROM SURVEY_QUESTION
		]]>
	</select>
	
	<select id="selectMaxItemId"  resultType="int">
		<![CDATA[
					SELECT NVL(MAX(ITEM_SEQ), 0) AS "itemSeq" FROM SURVEY_ITEM
		]]>
	</select>
	
	<insert id="setItemInsert" parameterType="SQD">
		<![CDATA[	
			INSERT INTO SURVEY_ITEM(QUESTION_SEQ, ITEM_SEQ, ITEM_CONTENT, ITEM_SCORE,ADD_DATE,UPDATE_DATE)
			values (#{questionSeq}, #{itemSeq}, #{itemContent}, #{itemScore},sysdate,sysdate)
		]]>
	</insert>
	
	<insert id="setSurvey" parameterType="SLD" >
		
		<selectKey keyProperty="surveySeq" resultType="int" order="BEFORE">
			select SURVEY_LIST_SEQ.nextval from dual	
		</selectKey>
		
		insert into SURVEY_LIST (SURVEY_SEQ,SURVEY_NAME, SURVEY_CONTENT,
		ANONYMITY_CHECK_CODE,SURVEY_STATR_DATE,SURVEY_CLOSED_DATE,DECIDE_YN, ADD_DATE, UPDATE_DATE) 
		values(#{surveySeq},#{surveyName},#{surveyContent},#{anonymityCheckCode},
		#{surveyStartDate},#{surveyClosedDate},'N', sysdate, sysdate)
	</insert>
	
	<update id="setSurveyUpdate" parameterType="SLD">
		UPDATE SURVEY_LIST SET SURVEY_NAME=#{surveyName}, SURVEY_CONTENT=#{surveyContent},
		ANONYMITY_CHECK_CODE=#{anonymityCheckCode},SURVEY_STATR_DATE=#{surveyStartDate},SURVEY_CLOSED_DATE=#{surveyClosedDate}, UPDATE_DATE=sysdate  WHERE SURVEY_SEQ=#{surveySeq}
	</update>
	
	<insert id="setItemUpdate" parameterType="SQD" >
		
		<selectKey keyProperty="itemSeq" resultType="int" order="BEFORE">
			select item_id_seq.nextval from dual	
		</selectKey>
		
		insert into survey_item (QUESTION_SEQ,ITEM_SEQ, ITEM_CONTENT,
		ITEM_SCORE, UPDATE_DATE) 
		values(#{questionSeq},#{itemSeq},#{itemContent},#{itemScore},sysdate)
	</insert>
	
	<delete id="setItemDelete" parameterType="SQD">
		delete from survey_item where question_seq = ${questionSeq}
		
	</delete>
	
	<select id="selectQuestion" parameterType="int" resultType="hashmap">
		select sq.survey_seq, sq.question_Seq, sq.question_content, sq.question_type_code, 
		si.item_seq, si.item_content, si.item_score 
		from SURVEY_ITEM si, survey_question sq 
		where si.question_seq=sq.question_seq and survey_seq = #{surveySeq}	 order by question_seq desc
	</select>
	
	<select id="selectSurveyList" resultType="com.mycompany.webapp.dto.SurveyListDTO">
		
		select SURVEY_SEQ as surveySeq, SURVEY_NAME as surveyName, SURVEY_CONTENT surveyContent, ANONYMITY_CHECK_CODE as anonymityCheckCode,
		SURVEY_STATR_DATE as surveyStartDate,  SURVEY_CLOSED_DATE as surveyClosedDate, DECIDE_YN as decideYN
			   from survey_list 
			   order by rownum desc
		
	
	</select>
	
	<select id="selectSurvey" parameterType="int" resultType="SLD">
		select SURVEY_SEQ as surveySeq, SURVEY_NAME as surveyName, SURVEY_CONTENT surveyContent, ANONYMITY_CHECK_CODE as anonymityCheckCode,
		SURVEY_STATR_DATE as surveyStartDate,  SURVEY_CLOSED_DATE as surveyClosedDate, DECIDE_YN as decideYN
			   from survey_list
			   where survey_seq = #{surveySeq}
	
	</select>
	
	<select id="getQuestionList" resultType="com.mycompany.webapp.dto.SurveyQuestionDTO">
		select QUESTION_SEQ AS questionSeq, QUESTION_CONTENT AS questContent, QUESTION_TYPE_CODE AS questionTypeCode
		FROM SURVEY_QUESTION WHERE SURVEY_SEQ = #{surveySeq} 
	</select>
	
	<update id="setQuestUpdate" parameterType="com.mycompany.webapp.dto.SurveyQuestionDTO">
		UPDATE SURVEY_QUESTION SET QUESTION_CONTENT=#{questionContent}, QUESTION_TYPE_CODE=#{questionTypeCode} WHERE QUESTION_SEQ=#{questionSeq}
	</update>
	
	<select id="getAddDate" parameterType="int" resultType="date">
		select ADD_DATE from survey_item where question_seq = #{questionSeq}
	</select>

</mapper>